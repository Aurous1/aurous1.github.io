<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Search</title>
	</head>
	<body>
		<input
			type="text"
			name="keyword"
			id="keyword"
			placeholder="Search..."
			autofocus
		/>

		<br />
		<br />

		<br />
		<input
			type="number"
			name="Season"
			id="season"
			placeholder="Season No."
		/>
		<input
			type="number"
			name="Episode"
			id="episode"
			placeholder="Episode No."
		/>

		<br />
		<br />

		<button id="submit" onclick="createURL()">Submit</button>

		<br />
		<br />

		<div id="container"></div>

		<h6>
			This is an educational project. <br />Credits to
			<a href="https://www.themoviedb.org/documentation/api">TMDB API</a>
			and
			<a href="https://2embed.ru/">2embed</a>
			for the content.
		</h6>

		<script>
			var input = document.getElementById("keyword");
			var epi = document.getElementById("episode");

			input.addEventListener("keyup", function (event) {
				// Number 13 is the "Enter" key on the keyboard
				if (event.keyCode === 13) {
					// Cancel the default action, if needed
					event.preventDefault();
					// Trigger the button element with a click
					document.getElementById("submit").click();
				}
			});

			epi.addEventListener("keyup", function (event) {
				// Number 13 is the "Enter" key on the keyboard
				if (event.keyCode === 13) {
					// Cancel the default action, if needed
					event.preventDefault();
					// Trigger the button element with a click
					document.getElementById("submit").click();
				}
			});

			function createURL() {
				var keyword = document.getElementById("keyword").value;

				var params = `api_key=0c6f4bd90f75e93d95d4c6fd9c806f4e&query=${keyword}`;
				var url = "https://api.themoviedb.org/3/search/multi?";

				url += params;

				callTMDBAPI(url);
			}

			function callTMDBAPI(url) {
				fetch(url)
					.then((response) => {
						return response.json();
					})
					.then((myJson) => {
						console.log(myJson);
						displayResults(myJson.results);
					});
			}

			function displayResults(arr) {
				var cont = document.getElementById("container");

				var ul = document.createElement("ul");
				ul.setAttribute("style", "padding: 0; margin: 0;");
				ul.setAttribute("id", "theList");

				var s = document.getElementById("season").value;
				if (s == "") {
					s = "1";
				}
				var e = document.getElementById("episode").value;
				if (e == "") {
					e = "1";
				}

				var arrLen = arr.length;
				for (i = 0; i <= arr.length - 1; i++) {
					var li = document.createElement("li");
					var type = arr[i].media_type;

					var params = "";
					var name = "";
					if (type == "movie") {
						name = arr[i].original_title;
					} else {
						name = arr[i].original_name;
						params = `&s=${s}&e=${e}`;
					}

					if (arrLen == 1) {
						window.location.href = `render.html?id=${arr[i].id}&type=${type}${params}`;
					}

					li.innerHTML = `<a href="render.html?id=${arr[i].id}&type=${type}${params}">[${type}], ${name}</a>`;
					li.setAttribute("style", "display: block;");

					ul.appendChild(li);
				}

				cont.appendChild(ul);
			}
		</script>
	</body>
</html>
